<Project DefaultTargets="PublishSite" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project=".\packages\MSBuildTasks.1.5.0.196\build\MSBuildTasks.targets" Condition="Exists('.\packages\MSBuildTasks.1.5.0.196\build\MSBuildTasks.targets')"/>

  <PropertyGroup>
    <PublishPath>$(ArtifactDir)\UberStrike.Channels.Portal</PublishPath>
  </PropertyGroup>

  <ItemGroup>
    <CommonToBuild Include="UberStrike.Channels.Common\UberStrike.Channels.Common.csproj" />
    <SiteToBuild Include="UberStrike.Channels.Portal\UberStrike.Channels.Portal.csproj" />
  </ItemGroup>

  <Target Name="PublishCommon">
    <MSBuild Projects="@(CommonToBuild)"
             Properties="Configuration=$(Configuration);WebProjectOutputDir=..\$(PublishPath)\CommonChannel\;OutDir=..\$(PublishPath)\CommonChannel\bin\" />

    <Copy SourceFiles="UberStrike.Channels.Common\Web.config.dev;
                        UberStrike.Channels.Common\Web.config.external.qa;
                        UberStrike.Channels.Common\Web.config.prod;"
          DestinationFolder="$(PublishPath)\CommonChannel" />
  </Target>

  <Target Name="PublishSite" DependsOnTargets="PublishCommon">
    <MSBuild Projects="@(SiteToBuild)"
             Properties="Configuration=$(Configuration);WebProjectOutputDir=..\$(PublishPath)\;OutDir=..\$(PublishPath)\bin\" />

    <Copy SourceFiles="UberStrike.Channels.Portal\Web.config.dev;
                        UberStrike.Channels.Portal\Web.config.external.qa;
                        UberStrike.Channels.Portal\Web.config.prod;"
          DestinationFolder="$(PublishPath)" />    
  </Target>

</Project>